<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dish Details - Multicultural Foods</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0; padding: 0;
            background: #f8f8f8;
            color: #333;
        }
        .sidebar {
            position: fixed;
            top: 0; left: 0;
            width: 70px; height: 100vh;
            background: #1f1f2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
        }
        .sidebar a {
            margin: 20px 0;
            font-size: 24px;
            color: white;
            text-decoration: none;
            transition: 0.3s;
        }
        .sidebar a:hover {
            color: #ffd369;
            transform: scale(1.2);
        }
        .main-content {
            margin-left: 90px;
            padding: 30px;
            max-width: 900px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-height: 80vh;
        }
        h2 {
            margin-bottom: 1rem;
        }
        .dish-header {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        .dish-header img {
            width: 250px;
            height: 250px;
            border-radius: 16px;
            object-fit: cover;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .dish-info {
            flex: 1;
        }
        .dish-info h3 {
            margin-top: 0;
        }
        .meta {
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }
        .ingredients {
            margin-top: 20px;
        }
        .ingredients h4 {
            margin-bottom: 10px;
        }
        .ingredients ul {
            list-style: disc inside;
            padding-left: 0;
            max-width: 400px;
        }
        .instructions {
            margin-top: 20px;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        .back-link {
            margin-top: 30px;
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .back-link:hover {
            background-color: #3e9142;
        }
    </style>
</head>
<body>
<div class="sidebar">
    <a href="login.html">üë§</a>
    <a href="index.html">üè†</a>
    <a href="searchpage.html">üîç</a>
    <a href="askai.html" class="disabled">ü§ñ</a>
</div>

<main class="main-content" role="main" aria-live="polite">
    <h2>Dish Details</h2>
    <div id="dishDetails">Loading dish details...</div>
    <a href="searchpage.html" class="back-link" aria-label="Back to search page">‚Üê Back to Search</a>
</main>

<script>
    // Get meal ID from URL params
    function getMealIdFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id') || params.get('idMeal');
    }


    // Fetch meal details by ID
    async function fetchMealDetails(id) {
        try {
            const res = await fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`);
            const data = await res.json();
            if (data.meals && data.meals.length > 0) {
                return data.meals[0];
            } else {
                return null;
            }
        } catch (err) {
            console.error('Error fetching meal details:', err);
            return null;
        }
    }

    // Extract ingredients + measures dynamically from meal object
    function getIngredientsList(meal) {
        const ingredients = [];
        for (let i = 1; i <= 20; i++) {
            const ingredient = meal[`strIngredient${i}`];
            const measure = meal[`strMeasure${i}`];
            if (ingredient && ingredient.trim()) {
                ingredients.push(`${measure ? measure.trim() : ''} ${ingredient.trim()}`.trim());
            }
        }
        return ingredients;
    }

    // Render meal details in HTML
    function renderMeal(meal) {
        if (!meal) {
            document.getElementById('dishDetails').innerHTML = '<p>Dish not found or invalid ID.</p>';
            return;
        }

        const ingredients = getIngredientsList(meal);

        document.getElementById('dishDetails').innerHTML = `
        <div class="dish-header">
          <img src="${meal.strMealThumb}" alt="Image of ${meal.strMeal}" />
          <div class="dish-info">
            <h3>${meal.strMeal}</h3>
            <div class="meta">
              <strong>Category:</strong> ${meal.strCategory || 'N/A'}<br/>
              <strong>Area (Country):</strong> ${meal.strArea || 'N/A'}<br/>
              ${meal.strTags ? `<strong>Tags:</strong> ${meal.strTags.split(',').join(', ')}<br/>` : ''}
              ${meal.strYoutube ? `<a href="${meal.strYoutube}" target="_blank" rel="noopener noreferrer">Watch on YouTube ‚ñ∂Ô∏è</a>` : ''}
            </div>
          </div>
        </div>

        <section class="ingredients" aria-label="Ingredients">
          <h4>Ingredients</h4>
          <ul>
            ${ingredients.map(i => `<li>${i}</li>`).join('')}
          </ul>
        </section>

        <section class="instructions" aria-label="Instructions">
          <h4>Instructions</h4>
          <p>${meal.strInstructions.replace(/\r\n/g, '<br>')}</p>
        </section>
      `;
    }

    async function init() {
        const mealId = getMealIdFromURL();
        if (!mealId) {
            document.getElementById('dishDetails').innerHTML = '<p>No dish selected.</p>';
            return;
        }
        const meal = await fetchMealDetails(mealId);
        renderMeal(meal);
    }

    init();
</script>

</body>
</html>
